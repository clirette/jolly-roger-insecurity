# My (Will's) solution for Judgement

When reversing the file, the vulnerability in this program was apparent before
too long. The program accepts user input (the potential flag), uses a printf to 
print it back out, and then says whether the flag is correct. The user input
that goes to the printf is accepted in the getnline function. It checks for
unprintable characters and will error out if those are provided, so providing
escaped addresses directly through input won't work! It also checks for a
newline to replace that with a null character for C string termination, and
input is limited to 0x40 characters as well.

However, because this printf accepts user input with no prior format string
argument, we can provide a format string ourselves. Without an initial
format string argument, if a user provides format characters (%c, %x, etc.),
printf will assume that there are arguments provided on the stack and will
happily consume whatever's on the stack for as many format characters are
provided.

For my solution, I assumed that there was no address randomization. Looking in
IDA, there is a buffer at address `0x0804a0a0` that stores a string loaded from
a local "flag.txt" file. So we don't have the file, but we know where the
string will be in memory.

Examining the stack in GDB at the time of the printf, the address that we want
for the flag is the 28th (decimal) word on the stack, counting from ESP.
We just need to dereference the address as a string, so all we need to send to
the server is the string "`%28$s`". This will grab the 28th argument on the stack,
treat it as a string pointer, and dereference the string. So, printf will print
"TWCTF{R3:l1f3_1n_4_pwn_w0rld_fr0m_z3r0}", which is our flag--you can submit
this to the judgement server to double-check.

Note that while I viewed the stack locally to find the string, there is a better
solution that others used. Scripting in Python, you can just iterate through
each of the arguments on the stack (from `%1$s` on) until "TWCTF" exists in the
data returned from the socket, and then just print that data as a string.
